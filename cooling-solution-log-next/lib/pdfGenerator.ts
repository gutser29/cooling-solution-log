import jsPDF from 'jspdf'
import autoTable from 'jspdf-autotable'
import type { EventRecord, Job, Invoice, Client, ClientPhoto, ClientDocument, Employee, RecurringContract } from './types'

// ============ COMPANY INFO ============
const COMPANY_NAME = 'Cooling Solution'
const COMPANY_SLOGAN = '"Donde tu confort es nuestra prioridad"'
const COMPANY_ADDRESS = 'PO BOX 168'
const COMPANY_CITY = 'Toa Alta, PR 00954'
const COMPANY_PHONE = '939-425-6081'
const COMPANY_EMAIL = 'sergio.gutierrez@coolingsolutionpr.com'

// ============ LOGO BASE64 ============
const LOGO_BASE64 = "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dKo0NCTQV7Gays/1dHT96733Z82aAf2mIGAsakTUPffcc999961ateqll14yGo29vb0vvfTSxx9//NRTT91///1O5vPnjho1iivkNTU1jz766JVXXsn9fpRS7s3bu3fvO++8IwhCV1fXhx9+OHfu3KlTpz7++OMtLS18l1FdXf3Pf/7Tucbp9Xqr1VpVVZWdnX3XXXc999xzGo2Gh9HwLT2/5MMPPxw7dmxMTAxfTDMzMx977LEnnnjiwQcf/MMf/qDRaIpLSl55+eUjR45s3LiRR97w3uYz5ODBgz09PcnJyQPcyMHBwQ6HgxtvX3nllSeffNKFRK5ZXgAIQLFYMrcdzw+ONSpMwUyg+IIHVFNERYolpNGrtRWfRmqXjh8znFFbVlWNIGw9cHh5VaeQMiFx/7pDt1wpeHkjAJUxEeM9J7KX5zWy1DSwQnDOoXVz01OSk4YsCXX+nb9bGdS+iP6mpqbVq1fv2LGjvr5eURSTyeTv7z916tQbbrghNDR08+bNmZmZTj8V///u3bs//PDDtrY2WZYDAgIIIbfffvuUKVNcLZnQP48lSfrss8/WrFkjy7LJZGKMRUZGPvjgg8HBwXRQElNDQ8Pvf//7wsLCqKiol19+OTk52ellQgg98sgje/bsAYA//OEPl112GV+AKaWvvPrK7l27pkye+tjjjwGAzWI5mpP30tq1x6sa0ny87IU5Gr2Jxqccyc2ZMXrUEzdch8y9Tz/7l3nz57U0N588ebKhoaGtrU2SJJ1OFxgYOH369Kefftrf338wDzmjHDbbujVrZs2b//q6dWv37PO3S/aOJskhaRCOCQ8bP278zbffFuDvT883rtL+VJI33niDUmqxWLy9vfV6/d13352RkTG466xW6wMPPLB3796QkJDf/e53V155JZ/TrN9P+Mwzz+zYscNkMqWlpa1YsWLevHmMsUOHDj366KONjY1Tpkz5+9//7pox1NLS8uSTTx49ejQqKuq222675JJLnOYcVVU///zzl156SRTF5cuXP/jgg5yZzmvffffdTz75RBRFRVE8PT0jIyPvueceTlTX1LampqYnn3yyqanp4Ycf5slxzgZ3d3f/+c9/3rJlS0JCwr333utaOuR8EjKGEHJ0daV/sbts1ASDTVUxvXACBQOGKVaxQkEb11G+f8Yon+EP++YhFyeKixeeabRHpU0o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"

function formatDate(ts: number): string {
  return new Date(ts).toLocaleDateString('es-PR', { year: 'numeric', month: 'long', day: 'numeric' })
}

function formatDateShort(ts: number): string {
  return new Date(ts).toLocaleDateString('es-PR', { year: 'numeric', month: 'short', day: 'numeric' })
}

function formatCurrency(n: number): string {
  return '$' + n.toFixed(2)
}

function getPaymentLabel(method?: string): string {
  if (!method) return 'N/A'
  const labels: Record<string, string> = {
    cash: 'Efectivo', ath_movil: 'ATH M√≥vil', capital_one: 'Capital One',
    chase_visa: 'Chase Visa', paypal: 'PayPal', check: 'Cheque',
    sams_mastercard: "Sam's MC", transfer: 'Transferencia',
    ach: 'ACH', credit_card: 'Tarjeta Cr√©dito', zelle: 'Zelle'
  }
  return labels[method] || method
}

function getCategoryLabel(cat: string): string {
  const labels: Record<string, string> = {
    before: 'üì∑ ANTES',
    after: '‚úÖ DESPU√âS',
    diagnostic: 'üîç DIAGN√ìSTICO',
    equipment: '‚öôÔ∏è EQUIPO',
    area: 'üìê √ÅREA',
    receipt: 'üßæ RECIBO',
    other: 'üìé OTROS'
  }
  return labels[cat] || cat.toUpperCase()
}

export function generateInvoiceNumber(type: 'invoice' | 'quote'): string {
  const prefix = type === 'invoice' ? 'CS-INV' : 'CS-COT'
  const d = new Date()
  const yr = d.getFullYear().toString().slice(-2)
  const mo = String(d.getMonth() + 1).padStart(2, '0')
  const rand = String(Math.floor(Math.random() * 9000) + 1000)
  return `${prefix}-${yr}${mo}-${rand}`
}

// ============ INVOICE PDF - ESTILO ANTHROPIC ============
export function generateInvoicePDF(invoice: Invoice): Blob {
  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const isQuote = invoice.type === 'quote'
  const title = isQuote ? 'Quote' : 'Invoice'
  const marginL = 20
  const marginR = 20

  // === TITLE (grande, arriba izquierda) ===
  doc.setFontSize(32)
  doc.setTextColor(30, 30, 30)
  doc.text(title, marginL, 28)

  // === LOGO (arriba derecha) ===
try {
    doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', 120, 16, 74, 31)
  } catch { }

  // === INVOICE META (debajo del t√≠tulo) ===
  let y = 40
  doc.setFontSize(10)
  doc.setTextColor(30, 30, 30)
  
  doc.setFont('helvetica', 'bold')
  doc.text('Invoice number', marginL, y)
  doc.setFont('helvetica', 'normal')
  doc.text(invoice.invoice_number, marginL + 35, y)
  
  y += 6
  doc.setFont('helvetica', 'bold')
  doc.text('Date of issue', marginL, y)
  doc.setFont('helvetica', 'normal')
  doc.text(formatDate(invoice.issue_date), marginL + 35, y)
  
  y += 6
  if (invoice.due_date && !isQuote) {
    doc.setFont('helvetica', 'bold')
    doc.text('Date due', marginL, y)
    doc.setFont('helvetica', 'normal')
    doc.text(formatDate(invoice.due_date), marginL + 35, y)
  }
  if (isQuote && invoice.expiration_date) {
    doc.setFont('helvetica', 'bold')
    doc.text('Valid until', marginL, y)
    doc.setFont('helvetica', 'normal')
    doc.text(formatDate(invoice.expiration_date), marginL + 35, y)
  }

  // === COMPANY INFO (izquierda) & BILL TO (derecha) - EN PARALELO ===
  y = 68
  const colRight = 110

  // Company info (izquierda)
  doc.setFontSize(10)
  doc.setFont('helvetica', 'bold')
  doc.setTextColor(30, 30, 30)
  doc.text(COMPANY_NAME, marginL, y)
  doc.setFont('helvetica', 'normal')
  doc.setTextColor(60, 60, 60)
  doc.text(COMPANY_ADDRESS, marginL, y + 5)
  doc.text(COMPANY_CITY, marginL, y + 10)
  doc.text(COMPANY_PHONE, marginL, y + 15)
  doc.text(COMPANY_EMAIL, marginL, y + 20)

  // Bill to (derecha)
  doc.setFont('helvetica', 'bold')
  doc.setTextColor(30, 30, 30)
  doc.text('Bill to', colRight, y)
  doc.setFont('helvetica', 'normal')
  doc.setTextColor(60, 60, 60)
  let billY = y + 5
  doc.text(invoice.client_name, colRight, billY)
  if (invoice.client_address) { billY += 5; doc.text(invoice.client_address, colRight, billY) }
  if (invoice.client_phone) { billY += 5; doc.text(invoice.client_phone, colRight, billY) }
  if (invoice.client_email) { billY += 5; doc.text(invoice.client_email, colRight, billY) }

  // === ITEMS TABLE ===
  y = 105
  
  // Header de tabla
  doc.setDrawColor(220, 220, 220)
  doc.setLineWidth(0.3)
  doc.line(marginL, y, pageW - marginR, y)
  
  y += 6
  doc.setFontSize(9)
  doc.setTextColor(80, 80, 80)
  doc.text('Description', marginL, y)
  doc.text('Qty', pageW - marginR - 55, y, { align: 'right' })
  doc.text('Unit price', pageW - marginR - 25, y, { align: 'right' })
  doc.text('Amount', pageW - marginR, y, { align: 'right' })
  
  y += 3
  doc.line(marginL, y, pageW - marginR, y)
  
  // Rows
  y += 7
  doc.setFontSize(10)
  doc.setTextColor(30, 30, 30)
  invoice.items.forEach((item) => {
    const maxDescWidth = pageW - marginL - marginR - 70
    const descLines = doc.splitTextToSize(item.description, maxDescWidth)
    doc.text(descLines, marginL, y)
    doc.text(String(item.quantity), pageW - marginR - 55, y, { align: 'right' })
    doc.text(formatCurrency(item.unit_price), pageW - marginR - 25, y, { align: 'right' })
    doc.text(formatCurrency(item.total), pageW - marginR, y, { align: 'right' })
    const lineHeight = 4.5
    y += Math.max(7, descLines.length * lineHeight + 3)
  })
  // === TOTALS (derecha, estilo Anthropic) ===
  y += 10
  const labelX = pageW - marginR - 60
  const valueX = pageW - marginR
  
  doc.setFontSize(10)
  doc.setTextColor(60, 60, 60)
  
  doc.text('Subtotal', labelX, y)
  doc.text(formatCurrency(invoice.subtotal), valueX, y, { align: 'right' })
  
  if (invoice.tax_rate > 0) {
    y += 6
    doc.text(`Tax (${invoice.tax_rate}%)`, labelX, y)
    doc.text(formatCurrency(invoice.tax_amount), valueX, y, { align: 'right' })
  }
  
  y += 6
  doc.text('Total', labelX, y)
  doc.text(formatCurrency(invoice.total), valueX, y, { align: 'right' })
  
  y += 6
  doc.setFont('helvetica', 'bold')
  doc.setTextColor(30, 30, 30)
  doc.text('Amount due', labelX, y)
  doc.text(`${formatCurrency(invoice.total)} USD`, valueX, y, { align: 'right' })
  doc.setFont('helvetica', 'normal')

  // === NOTES ===
  if (invoice.notes) {
    y += 20
    doc.setFontSize(9)
    doc.setTextColor(80, 80, 80)
    const lines = doc.splitTextToSize(invoice.notes, pageW - marginL - marginR)
    doc.text(lines, marginL, y)
  }

  // === PAID STAMP ===
  if (invoice.status === 'paid' && invoice.paid_date) {
    y += 15
    doc.setFontSize(10)
    doc.setTextColor(34, 197, 94)
    doc.setFont('helvetica', 'bold')
    doc.text(`‚úì PAID - ${formatDate(invoice.paid_date)} (${getPaymentLabel(invoice.paid_method)})`, marginL, y)
    doc.setFont('helvetica', 'normal')
  }

  // === FOOTER (l√≠nea, eslogan centrado, p√°gina) ===
  doc.setDrawColor(220, 220, 220)
  doc.setLineWidth(0.3)
  doc.line(marginL, pageH - 22, pageW - marginR, pageH - 22)
  
  doc.setFontSize(9)
  doc.setTextColor(0, 150, 150)
  doc.setFont('helvetica', 'italic')
  doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 14, { align: 'center' })
  doc.setFont('helvetica', 'normal')
  
  doc.setTextColor(120, 120, 120)
  doc.text('Page 1 of 1', pageW - marginR, pageH - 6, { align: 'right' })

  return doc.output('blob')
}

export function downloadInvoicePDF(invoice: Invoice) {
  const blob = generateInvoicePDF(invoice)
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  const prefix = invoice.type === 'quote' ? 'Quote' : 'Invoice'
  a.href = url
  a.download = `${prefix}-${invoice.invoice_number}.pdf`
  a.click()
  URL.revokeObjectURL(url)
}

// ============ CATEGORY REPORT ============
export function generateCategoryReport(
  events: EventRecord[],
  category: string,
  startDate: number,
  endDate: number
) {
  const filtered = events.filter(e =>
    e.timestamp >= startDate &&
    e.timestamp <= endDate &&
    (category === 'general' || category === 'gastos' || category === 'ingresos' || category === 'personales' || category === 'veh√≠culos' || e.category?.toLowerCase() === category.toLowerCase())
  )

  const doc = new jsPDF()
  doc.setFontSize(16)
  doc.setTextColor(0, 150, 150)
  doc.text(`${COMPANY_NAME} - Reporte ${category}`, 14, 15)
  doc.setFontSize(10)
  doc.setTextColor(80, 80, 80)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, 14, 22)

  if (filtered.length === 0) {
    doc.text('No hay registros para este per√≠odo.', 14, 35)
  } else {
    autoTable(doc, {
      startY: 30,
      head: [['Fecha', 'Tipo', 'Categor√≠a', 'Monto', 'Detalle', 'M√©todo']],
      body: filtered.map(e => [
        formatDateShort(e.timestamp),
        e.type === 'income' ? 'Ingreso' : 'Gasto',
        e.category || '-',
        formatCurrency(e.amount),
        e.vendor || e.client || e.note || '-',
        getPaymentLabel(e.payment_method)
      ]),
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255] },
      bodyStyles: { fontSize: 8 }
    })

    const finalY = (doc as any).lastAutoTable.finalY + 10
    const totalIncome = filtered.filter(e => e.type === 'income').reduce((s, e) => s + e.amount, 0)
    const totalExpense = filtered.filter(e => e.type === 'expense').reduce((s, e) => s + e.amount, 0)
    
    doc.setFontSize(10)
    doc.text(`Total Ingresos: ${formatCurrency(totalIncome)}`, 14, finalY)
    doc.text(`Total Gastos: ${formatCurrency(totalExpense)}`, 14, finalY + 6)
    doc.setFont('helvetica', 'bold')
    doc.text(`Neto: ${formatCurrency(totalIncome - totalExpense)}`, 14, finalY + 12)
  }

  doc.save(`Reporte-${category}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ P&L REPORT ============
export function generatePLReport(
  events: EventRecord[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const filtered = events.filter(e => 
    e.timestamp >= startDate && 
    e.timestamp <= endDate &&
    e.expense_type !== 'personal'
  )

  const income = filtered.filter(e => e.type === 'income')
  const expenses = filtered.filter(e => e.type === 'expense')
  const totalIncome = income.reduce((s, e) => s + e.amount, 0)
  const totalExpense = expenses.reduce((s, e) => s + e.amount, 0)
  const profit = totalIncome - totalExpense

  const expenseByCategory: Record<string, number> = {}
  expenses.forEach(e => {
    const cat = e.category || 'Otros'
    expenseByCategory[cat] = (expenseByCategory[cat] || 0) + e.amount
  })

  const incomeByCategory: Record<string, number> = {}
  income.forEach(e => {
    const cat = e.category || 'Otros'
    incomeByCategory[cat] = (incomeByCategory[cat] || 0) + e.amount
  })

  const doc = new jsPDF()
  doc.setFontSize(18)
  doc.setTextColor(0, 150, 150)
  doc.text(`${COMPANY_NAME}`, 14, 15)
  doc.setFontSize(14)
  doc.setTextColor(40, 40, 40)
  doc.text(`Estado de P√©rdidas y Ganancias - ${periodLabel}`, 14, 24)
  doc.setFontSize(9)
  doc.setTextColor(100, 100, 100)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, 14, 30)

  let y = 42

  doc.setFontSize(11)
  doc.setTextColor(34, 197, 94)
  doc.setFont('helvetica', 'bold')
  doc.text('INGRESOS', 14, y)
  doc.setFont('helvetica', 'normal')
  y += 7

  doc.setFontSize(9)
  doc.setTextColor(60, 60, 60)
  Object.entries(incomeByCategory).sort((a, b) => b[1] - a[1]).forEach(([cat, total]) => {
    doc.text(cat, 20, y)
    doc.text(formatCurrency(total), 100, y, { align: 'right' })
    y += 5
  })
  
  y += 3
  doc.setFont('helvetica', 'bold')
  doc.setTextColor(34, 197, 94)
  doc.text('Total Ingresos', 20, y)
  doc.text(formatCurrency(totalIncome), 100, y, { align: 'right' })
  doc.setFont('helvetica', 'normal')

  y += 12
  doc.setFontSize(11)
  doc.setTextColor(239, 68, 68)
  doc.setFont('helvetica', 'bold')
  doc.text('GASTOS', 14, y)
  doc.setFont('helvetica', 'normal')
  y += 7

  doc.setFontSize(9)
  doc.setTextColor(60, 60, 60)
  Object.entries(expenseByCategory).sort((a, b) => b[1] - a[1]).forEach(([cat, total]) => {
    doc.text(cat, 20, y)
    doc.text(formatCurrency(total), 100, y, { align: 'right' })
    y += 5
  })

  y += 3
  doc.setFont('helvetica', 'bold')
  doc.setTextColor(239, 68, 68)
  doc.text('Total Gastos', 20, y)
  doc.text(formatCurrency(totalExpense), 100, y, { align: 'right' })
  doc.setFont('helvetica', 'normal')

  y += 12
  doc.setDrawColor(200, 200, 200)
  doc.line(14, y - 3, 110, y - 3)
  
  doc.setFontSize(12)
  doc.setFont('helvetica', 'bold')
  const profitColor = profit >= 0 ? [34, 197, 94] : [239, 68, 68]
  doc.setTextColor(profitColor[0], profitColor[1], profitColor[2])
  doc.text(profit >= 0 ? 'GANANCIA NETA' : 'P√âRDIDA NETA', 14, y)
  doc.text(formatCurrency(Math.abs(profit)), 100, y, { align: 'right' })

  if (totalIncome > 0) {
    y += 8
    doc.setFontSize(9)
    doc.setTextColor(100, 100, 100)
    const margin = ((profit / totalIncome) * 100).toFixed(1)
    doc.text(`Margen: ${margin}%`, 14, y)
  }

  doc.save(`P&L-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ AR REPORT ============
export function generateARReport(invoices: Invoice[]) {
  const pending = invoices.filter(inv => 
    inv.type === 'invoice' && 
    (inv.status === 'sent' || inv.status === 'overdue' || inv.status === 'draft')
  )

  const doc = new jsPDF()
  doc.setFontSize(16)
  doc.setTextColor(0, 150, 150)
  doc.text(`${COMPANY_NAME} - Cuentas por Cobrar`, 14, 15)
  doc.setFontSize(10)
  doc.setTextColor(80, 80, 80)
  doc.text(`Generado: ${formatDate(Date.now())}`, 14, 22)

  if (pending.length === 0) {
    doc.setFontSize(12)
    doc.text('üéâ No hay facturas pendientes', 14, 40)
  } else {
    const total = pending.reduce((s, inv) => s + inv.total, 0)
    
    doc.setFontSize(14)
    doc.setTextColor(239, 68, 68)
    doc.text(`Total Pendiente: ${formatCurrency(total)}`, 14, 32)

    autoTable(doc, {
      startY: 40,
      head: [['#', 'Cliente', 'Fecha', 'Vence', 'Status', 'Total']],
      body: pending.map(inv => [
        inv.invoice_number,
        inv.client_name,
        formatDateShort(inv.issue_date),
        inv.due_date ? formatDateShort(inv.due_date) : '-',
        inv.status === 'overdue' ? 'VENCIDA' : inv.status === 'sent' ? 'Enviada' : 'Borrador',
        formatCurrency(inv.total)
      ]),
      headStyles: { fillColor: [0, 150, 150] },
      bodyStyles: { fontSize: 9 },
      columnStyles: { 4: { cellWidth: 25, fontStyle: 'bold' } },
      didParseCell: (data) => {
        if (data.column.index === 4 && data.cell.raw === 'VENCIDA') {
          data.cell.styles.textColor = [239, 68, 68]
        }
      }
    })
  }

  doc.save(`Cuentas-por-Cobrar-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ PAYMENT METHOD REPORT ============
export function generatePaymentMethodReport(
  events: EventRecord[],
  paymentMethod: string,
  startDate: number,
  endDate: number
) {
  const filtered = events.filter(e =>
    e.timestamp >= startDate &&
    e.timestamp <= endDate &&
    e.payment_method?.toLowerCase().includes(paymentMethod.replace(/_/g, ' ').toLowerCase())
  )

  const doc = new jsPDF()
  doc.setFontSize(16)
  doc.setTextColor(0, 150, 150)
  doc.text(`${COMPANY_NAME} - Reporte ${getPaymentLabel(paymentMethod)}`, 14, 15)
  doc.setFontSize(10)
  doc.setTextColor(80, 80, 80)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, 14, 22)

  if (filtered.length === 0) {
    doc.text('No hay registros para este m√©todo de pago.', 14, 35)
  } else {
    const catSummary: Record<string, number> = {}
    filtered.forEach(e => {
      const cat = e.category || 'Otros'
      catSummary[cat] = (catSummary[cat] || 0) + e.amount
    })

    autoTable(doc, {
      startY: 30,
      head: [['Fecha', 'Categor√≠a', 'Monto', 'Detalle']],
      body: filtered.map(e => [
        formatDateShort(e.timestamp),
        e.category || '-',
        formatCurrency(e.amount),
        e.vendor || e.note || '-'
      ]),
      foot: [['TOTAL', '', formatCurrency(filtered.reduce((s, e) => s + e.amount, 0)), '']]
    })

    const finalY = (doc as any).lastAutoTable.finalY + 10
    doc.setFontSize(11)
    doc.text('Por categor√≠a:', 14, finalY)
    let y = finalY + 7
    doc.setFontSize(9)
    Object.entries(catSummary).sort((a, b) => b[1] - a[1]).forEach(([cat, total]) => {
      doc.text(`${cat}: ${formatCurrency(total)}`, 20, y)
      y += 5
    })
  }

  doc.save(`${paymentMethod}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ PHOTO REPORT - MEJORADO ============
export function generatePhotoReport(
  photos: ClientPhoto[],
  clientName: string,
  jobDescription?: string
) {
  if (photos.length === 0) {
    alert('No hay fotos para este reporte')
    return
  }

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 15
  const marginR = 15
  const contentW = pageW - marginL - marginR

  // Agrupar fotos por fecha (d√≠a)
  const photosByDate: Record<string, ClientPhoto[]> = {}
  photos.forEach(photo => {
    const dateKey = new Date(photo.timestamp).toLocaleDateString('es-PR')
    if (!photosByDate[dateKey]) photosByDate[dateKey] = []
    photosByDate[dateKey].push(photo)
  })

  // Ordenar fechas de m√°s reciente a m√°s antigua
  const sortedDates = Object.keys(photosByDate).sort((a, b) => {
    const dateA = new Date(photosByDate[a][0].timestamp)
    const dateB = new Date(photosByDate[b][0].timestamp)
    return dateB.getTime() - dateA.getTime()
  })

  // === HEADER ===
  const addHeader = (pageNum: number) => {
    // Logo principal
    try {
      doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17)
    } catch { }

    doc.setFontSize(14)
    doc.setTextColor(0, 150, 150)
    doc.setFont('helvetica', 'bold')
    doc.text(COMPANY_NAME, marginL, 18)
    doc.setFont('helvetica', 'normal')

    doc.setFontSize(9)
    doc.setTextColor(80, 80, 80)
    doc.text(COMPANY_ADDRESS, marginL, 24)
    doc.text(COMPANY_CITY, marginL, 28)
    doc.text(`Tel: ${COMPANY_PHONE}`, marginL, 32)

    // L√≠nea separadora
    doc.setDrawColor(0, 150, 150)
    doc.setLineWidth(0.5)
    doc.line(marginL, 38, pageW - marginR, 38)

    // Info del cliente
    doc.setFontSize(12)
    doc.setTextColor(30, 30, 30)
    doc.setFont('helvetica', 'bold')
    doc.text(`Reporte de Fotos - ${clientName}`, marginL, 48)
    doc.setFont('helvetica', 'normal')

    if (jobDescription) {
      doc.setFontSize(10)
      doc.setTextColor(60, 60, 60)
      doc.text(jobDescription, marginL, 54)
    }

    doc.setFontSize(9)
    doc.setTextColor(100, 100, 100)
    doc.text(`Generado: ${formatDate(Date.now())}`, marginL, jobDescription ? 60 : 54)
    doc.text(`Total: ${photos.length} foto(s)`, marginL + 80, jobDescription ? 60 : 54)
  }

  // === FOOTER ===
  const addFooter = (pageNum: number, totalPages: number) => {
    doc.setDrawColor(200, 200, 200)
    doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 18, pageW - marginR, pageH - 18)
    
    doc.setFontSize(8)
    doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 12, { align: 'center' })
    doc.text(`${COMPANY_PHONE} | ${COMPANY_EMAIL}`, pageW / 2, pageH - 7, { align: 'center' })
    doc.text(`P√°gina ${pageNum}`, pageW - marginR, pageH - 7, { align: 'right' })
  }

  let currentPage = 1
  addHeader(currentPage)

  let y = 70
  const imgWidth = 170
  const imgHeight = 130

  // Iterar por cada fecha
  sortedDates.forEach((dateKey, dateIndex) => {
    const datePhotos = photosByDate[dateKey]
    
    // Check si necesitamos nueva p√°gina para el t√≠tulo de fecha
    if (y > pageH - 100) {
      addFooter(currentPage, sortedDates.length)
      doc.addPage()
      currentPage++
      addHeader(currentPage)
      y = 70
    }

    // T√≠tulo de la fecha
    doc.setFontSize(11)
    doc.setTextColor(0, 150, 150)
    doc.setFont('helvetica', 'bold')
    doc.text(`üìÖ ${formatDate(datePhotos[0].timestamp)}`, marginL, y)
    doc.setFont('helvetica', 'normal')
    
    // L√≠nea bajo la fecha
    doc.setDrawColor(200, 200, 200)
    doc.setLineWidth(0.2)
    doc.line(marginL, y + 2, pageW - marginR, y + 2)
    y += 10

    // Agrupar por categor√≠a dentro de la fecha
    const categories = ['before', 'after', 'diagnostic', 'equipment', 'area', 'other']
    
    categories.forEach(cat => {
      const catPhotos = datePhotos.filter(p => p.category === cat)
      if (catPhotos.length === 0) return

      // Check si necesitamos nueva p√°gina
      if (y > pageH - 90) {
        addFooter(currentPage, sortedDates.length)
        doc.addPage()
        currentPage++
        addHeader(currentPage)
        y = 70
      }

      // T√≠tulo de categor√≠a
      doc.setFontSize(10)
      doc.setTextColor(60, 60, 60)
      doc.setFont('helvetica', 'bold')
      doc.text(getCategoryLabel(cat), marginL + 5, y)
      doc.setFont('helvetica', 'normal')
      y += 6

      catPhotos.forEach((photo, idx) => {
        // Check si necesitamos nueva p√°gina
        if (y > pageH - 160) {
          addFooter(currentPage, sortedDates.length)
          doc.addPage()
          currentPage++
          addHeader(currentPage)
          y = 70
        }

        // A√±adir imagen centrada
        const imgX = (pageW - imgWidth) / 2
        try {
          // Usar dataURL completo para preservar colores
          doc.addImage(photo.photo_data, imgX, y, imgWidth, imgHeight)
          
          // Borde sutil
          doc.setDrawColor(220, 220, 220)
          doc.setLineWidth(0.3)
          doc.rect(imgX, y, imgWidth, imgHeight)
        } catch {
          doc.setDrawColor(200, 200, 200)
          doc.rect(imgX, y, imgWidth, imgHeight)
          doc.setFontSize(10)
          doc.setTextColor(150, 150, 150)
          doc.text('Imagen no disponible', imgX + 50, y + 65)
        }

        // Descripci√≥n
        let descY = y + imgHeight + 4
        if (photo.description) {
          doc.setFontSize(9)
          doc.setTextColor(40, 40, 40)
          const descLines = doc.splitTextToSize(photo.description, imgWidth)
          doc.text(descLines.slice(0, 2), imgX, descY)
          descY += descLines.slice(0, 2).length * 4
        }

        // Equipo/ubicaci√≥n si existe
        if (photo.equipment_type || photo.location) {
          doc.setFontSize(8)
          doc.setTextColor(100, 100, 100)
          const info = [photo.equipment_type, photo.location].filter(Boolean).join(' | ')
          doc.text(info, imgX, descY + 3)
        }

        // 1 imagen por fila para m√°xima calidad
        y += imgHeight + 25
      })

      y += 5 // Espacio entre categor√≠as
    })

    y += 8 // Espacio entre fechas
  })

  // Footer en √∫ltima p√°gina
  addFooter(currentPage, currentPage)

  const safeName = clientName.replace(/[^a-zA-Z0-9]/g, '-')
  doc.save(`Fotos-${safeName}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ CLIENT LIST PDF ============
export function generateClientListPDF(clients: Client[]) {
  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20
  const marginR = 20

  doc.setFontSize(18)
  doc.setTextColor(0, 150, 150)
  doc.text(COMPANY_NAME, marginL, 18)
  
  doc.setFontSize(14)
  doc.setTextColor(40, 40, 40)
  doc.text('Lista de Clientes', marginL, 28)
  
  doc.setFontSize(10)
  doc.setTextColor(80, 80, 80)
  doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 36)
  doc.text(`Total: ${clients.length} clientes`, marginL, 42)

  try {
    doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17)
  } catch { }

  if (clients.length === 0) {
    doc.setFontSize(12)
    doc.text('No hay clientes registrados', marginL, 60)
  } else {
    autoTable(doc, {
      startY: 50,
      head: [['Nombre', 'Tipo', 'Tel√©fono', 'Email', 'Direcci√≥n']],
      body: clients.map(c => [
        `${c.first_name} ${c.last_name}`,
        c.type === 'commercial' ? 'Comercial' : 'Residencial',
        c.phone || '-',
        c.email || '-',
        c.address || '-'
      ]),
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 10, fontStyle: 'bold' },
      bodyStyles: { fontSize: 9, textColor: [40, 40, 40] },
      alternateRowStyles: { fillColor: [245, 245, 245] },
      columnStyles: {
        0: { cellWidth: 45 },
        1: { cellWidth: 30 },
        2: { cellWidth: 35 },
        3: { cellWidth: 45 },
        4: { cellWidth: 'auto' }
      }
    })
  }

  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i)
    doc.setDrawColor(200, 200, 200)
    doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8)
    doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }

  doc.save(`Lista-Clientes-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ DOCUMENT LIST PDF ============
export function generateDocumentListPDF(docs: ClientDocument[], clientName: string) {
  if (docs.length === 0) {
    alert('No hay documentos para este reporte')
    return
  }

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20
  const marginR = 20

  doc.setFontSize(18)
  doc.setTextColor(0, 150, 150)
  doc.text(COMPANY_NAME, marginL, 18)
  
  doc.setFontSize(14)
  doc.setTextColor(40, 40, 40)
  doc.text(`Documentos - ${clientName}`, marginL, 28)
  
  doc.setFontSize(10)
  doc.setTextColor(80, 80, 80)
  doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 36)
  doc.text(`Total: ${docs.length} documento(s)`, marginL, 42)

  try {
    doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17)
  } catch { }

  const docTypeLabels: Record<string, string> = {
    contract: 'Contrato',
    permit: 'Permiso',
    warranty: 'Garant√≠a',
    manual: 'Manual',
    receipt: 'Recibo',
    agreement: 'Acuerdo',
    other: 'Otro'
  }

  autoTable(doc, {
    startY: 50,
    head: [['Nombre', 'Tipo', 'Fecha', 'Vencimiento', 'Descripci√≥n']],
    body: docs.map(d => [
      d.file_name,
      docTypeLabels[d.doc_type] || d.doc_type,
      formatDateShort(d.timestamp),
      d.expiration_date ? formatDateShort(d.expiration_date) : '-',
      d.description || '-'
    ]),
    headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 10, fontStyle: 'bold' },
    bodyStyles: { fontSize: 9, textColor: [40, 40, 40] },
    alternateRowStyles: { fillColor: [245, 245, 245] }
  })

  doc.setDrawColor(200, 200, 200)
  doc.setLineWidth(0.3)
  doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
  doc.setFontSize(8)
  doc.setTextColor(150, 150, 150)
  doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })

  const safeName = clientName.replace(/[^a-zA-Z0-9]/g, '-')
  doc.save(`Documentos-${safeName}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ PAYROLL / N√ìMINA REPORT ============
export function generatePayrollReport(
  events: EventRecord[],
  employees: Employee[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const payrollEvents = events.filter(e =>
    e.timestamp >= startDate &&
    e.timestamp <= endDate &&
    e.type === 'expense' &&
    e.employee_id != null
  )

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20
  const marginR = 20

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(14); doc.setTextColor(40, 40, 40); doc.text(`Reporte de N√≥mina - ${periodLabel}`, marginL, 28)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, marginL, 34)
  doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 39)

  const byEmployee: Record<number, { name: string; events: EventRecord[]; total: number }> = {}

  payrollEvents.forEach(e => {
    const empId = e.employee_id!
    if (!byEmployee[empId]) {
      const emp = employees.find(em => em.id === empId)
      byEmployee[empId] = {
        name: emp ? `${emp.first_name} ${emp.last_name}` : `Empleado #${empId}`,
        events: [],
        total: 0
      }
    }
    byEmployee[empId].events.push(e)
    byEmployee[empId].total += e.amount
  })

  const grandTotal = payrollEvents.reduce((s, e) => s + e.amount, 0)

  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('Resumen por Empleado', marginL, 50); doc.setFont('helvetica', 'normal')

  const summaryRows = Object.values(byEmployee)
    .sort((a, b) => b.total - a.total)
    .map(emp => [emp.name, String(emp.events.length), formatCurrency(emp.total)])

  autoTable(doc, {
    startY: 55,
    head: [['Empleado', '# Pagos', 'Total']],
    body: summaryRows,
    foot: [['TOTAL', String(payrollEvents.length), formatCurrency(grandTotal)]],
    headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255] },
    footStyles: { fillColor: [240, 240, 240], fontStyle: 'bold', textColor: [30, 30, 30] },
    bodyStyles: { fontSize: 9 }
  })

  let detailY = (doc as any).lastAutoTable.finalY + 15

  Object.values(byEmployee).sort((a, b) => b.total - a.total).forEach(emp => {
    if (detailY > pageH - 60) { doc.addPage(); detailY = 20 }

    doc.setFontSize(10); doc.setTextColor(0, 150, 150); doc.setFont('helvetica', 'bold')
    doc.text(emp.name, marginL, detailY); doc.setFont('helvetica', 'normal')

    autoTable(doc, {
      startY: detailY + 3,
      head: [['Fecha', 'Monto', 'M√©todo', 'Nota']],
      body: emp.events.map(e => [
        formatDateShort(e.timestamp), formatCurrency(e.amount),
        getPaymentLabel(e.payment_method), e.note || '-'
      ]),
      headStyles: { fillColor: [60, 60, 60], textColor: [255, 255, 255], fontSize: 8 },
      bodyStyles: { fontSize: 8 }, margin: { left: marginL + 5 }
    })
    detailY = (doc as any).lastAutoTable.finalY + 12
  })

  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i); doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }

  doc.save(`Nomina-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ EXPENSES WITH RECEIPT PHOTOS REPORT ============
export function generateExpenseReceiptsReport(
  events: EventRecord[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const withPhotos = events.filter(e =>
    e.timestamp >= startDate &&
    e.timestamp <= endDate &&
    e.type === 'expense' &&
    ((e.receipt_photos && e.receipt_photos.length > 0) || e.photo)
  )

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 15
  const marginR = 15

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(16); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(12); doc.setTextColor(40, 40, 40); doc.text(`Gastos con Recibos - ${periodLabel}`, marginL, 27)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, marginL, 33)
  doc.text(`Total: ${withPhotos.length} gastos con recibos`, marginL, 38)

  const totalAmount = withPhotos.reduce((s, e) => s + e.amount, 0)
  doc.setFont('helvetica', 'bold'); doc.text(`Monto Total: ${formatCurrency(totalAmount)}`, marginL, 43); doc.setFont('helvetica', 'normal')

  let y = 52
  let currentPage = 1

  const addFooter = () => {
    doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
  }

  withPhotos.sort((a, b) => b.timestamp - a.timestamp).forEach((event, idx) => {
    if (y > pageH - 130) { addFooter(); doc.addPage(); currentPage++; y = 20 }

    const contentW = pageW - marginL - marginR
    doc.setDrawColor(0, 150, 150); doc.setLineWidth(0.3)
    doc.setFillColor(248, 248, 248); doc.roundedRect(marginL, y, contentW, 22, 2, 2, 'FD')

    doc.setFontSize(10); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
    doc.text(`#${idx + 1} ‚Äî ${formatDateShort(event.timestamp)}`, marginL + 4, y + 6); doc.setFont('helvetica', 'normal')

    doc.setFontSize(9)
    doc.text(`Monto: ${formatCurrency(event.amount)}`, marginL + 4, y + 12)
    doc.text(`Categor√≠a: ${event.category || '-'}`, marginL + 60, y + 12)
    doc.text(`M√©todo: ${getPaymentLabel(event.payment_method)}`, marginL + 120, y + 12)

    doc.setTextColor(80, 80, 80); doc.text(`Detalle: ${event.vendor || event.note || '-'}`, marginL + 4, y + 18)
    if (event.expense_type === 'personal') {
      doc.setTextColor(168, 85, 247); doc.text('PERSONAL', pageW - marginR - 25, y + 6)
    }

    y += 26

    const photos: string[] = []
    if (event.receipt_photos && event.receipt_photos.length > 0) photos.push(...event.receipt_photos)
    else if (event.photo) photos.push(event.photo)

    photos.forEach((photoData) => {
      if (y > pageH - 120) { addFooter(); doc.addPage(); currentPage++; y = 20 }
      const imgW = 160, imgH = 100, imgX = (pageW - imgW) / 2
      try {
        const imgSrc = photoData.startsWith('data:') ? photoData : `data:image/jpeg;base64,${photoData}`
        doc.addImage(imgSrc, imgX, y, imgW, imgH)
        doc.setDrawColor(220, 220, 220); doc.setLineWidth(0.2); doc.rect(imgX, y, imgW, imgH)
      } catch {
        doc.setDrawColor(200, 200, 200); doc.rect(imgX, y, imgW, imgH)
        doc.setFontSize(9); doc.setTextColor(150, 150, 150); doc.text('Imagen no disponible', imgX + 50, y + 50)
      }
      y += imgH + 8
    })
    y += 10
  })

  addFooter()
  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i); doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }

  doc.save(`Gastos-Recibos-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ ACCOUNTANT REPORT ============
export function generateAccountantReport(
  events: EventRecord[],
  invoices: Invoice[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const filtered = events.filter(e => e.timestamp >= startDate && e.timestamp <= endDate)
  const businessEvents = filtered.filter(e => e.expense_type !== 'personal')
  const personalExpenses = filtered.filter(e => e.type === 'expense' && e.expense_type === 'personal')

  const income = businessEvents.filter(e => e.type === 'income')
  const expenses = businessEvents.filter(e => e.type === 'expense')
  const totalIncome = income.reduce((s, e) => s + e.amount, 0)
  const totalExpense = expenses.reduce((s, e) => s + e.amount, 0)
  const totalPersonal = personalExpenses.reduce((s, e) => s + e.amount, 0)
  const profit = totalIncome - totalExpense

  const periodInvoices = invoices.filter(inv => inv.type === 'invoice' && inv.created_at >= startDate && inv.created_at <= endDate)
  const taxCollected = periodInvoices.reduce((s, inv) => s + (inv.tax_amount || 0), 0)

  const expByCat: Record<string, number> = {}
  expenses.forEach(e => { expByCat[e.category || 'Otros'] = (expByCat[e.category || 'Otros'] || 0) + e.amount })
  const incByCat: Record<string, number> = {}
  income.forEach(e => { incByCat[e.category || 'Otros'] = (incByCat[e.category || 'Otros'] || 0) + e.amount })
  const expByMethod: Record<string, number> = {}
  expenses.forEach(e => { expByMethod[e.payment_method || 'other'] = (expByMethod[e.payment_method || 'other'] || 0) + e.amount })

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20, marginR = 20

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(13); doc.setTextColor(40, 40, 40); doc.text(`Reporte para Contable - ${periodLabel}`, marginL, 27)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, marginL, 33)
  doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 38)

  let y = 48
  doc.setDrawColor(0, 150, 150); doc.setLineWidth(0.5); doc.line(marginL, y, pageW - marginR, y); y += 8
  doc.setFontSize(12); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('RESUMEN EJECUTIVO', marginL, y); doc.setFont('helvetica', 'normal'); y += 8

  const summaryData = [
    ['Ingresos Brutos', formatCurrency(totalIncome)], ['Gastos de Negocio', formatCurrency(totalExpense)],
    ['Ganancia/P√©rdida Neta', formatCurrency(profit)],
    ['Margen', totalIncome > 0 ? ((profit / totalIncome) * 100).toFixed(1) + '%' : 'N/A'],
    ['', ''],
    ['IVU Cobrado (en facturas)', formatCurrency(taxCollected)],
    ['Gastos Personales (no deducibles)', formatCurrency(totalPersonal)],
    ['Total Transacciones', String(filtered.length)]
  ]

  doc.setFontSize(10)
  summaryData.forEach(([label, value]) => {
    if (label === '') { y += 4; return }
    doc.setTextColor(60, 60, 60); doc.text(label, marginL + 5, y)
    doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
    doc.text(value, 120, y, { align: 'right' }); doc.setFont('helvetica', 'normal'); y += 6
  })

  y += 10
  doc.setFontSize(11); doc.setTextColor(34, 197, 94); doc.setFont('helvetica', 'bold')
  doc.text('INGRESOS POR CATEGOR√çA', marginL, y); doc.setFont('helvetica', 'normal'); y += 6
  doc.setFontSize(9)
  Object.entries(incByCat).sort((a, b) => b[1] - a[1]).forEach(([cat, total]) => {
    doc.setTextColor(60, 60, 60); doc.text(cat, marginL + 5, y); doc.text(formatCurrency(total), 120, y, { align: 'right' }); y += 5
  })

  y += 8
  doc.setFontSize(11); doc.setTextColor(239, 68, 68); doc.setFont('helvetica', 'bold')
  doc.text('GASTOS DEDUCIBLES POR CATEGOR√çA', marginL, y); doc.setFont('helvetica', 'normal'); y += 6
  doc.setFontSize(9)
  Object.entries(expByCat).sort((a, b) => b[1] - a[1]).forEach(([cat, total]) => {
    doc.setTextColor(60, 60, 60); doc.text(cat, marginL + 5, y); doc.text(formatCurrency(total), 120, y, { align: 'right' }); y += 5
    if (y > pageH - 40) { doc.addPage(); y = 20 }
  })

  y += 8; if (y > pageH - 60) { doc.addPage(); y = 20 }
  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('GASTOS POR M√âTODO DE PAGO', marginL, y); doc.setFont('helvetica', 'normal'); y += 6
  doc.setFontSize(9)
  Object.entries(expByMethod).sort((a, b) => b[1] - a[1]).forEach(([method, total]) => {
    doc.setTextColor(60, 60, 60); doc.text(getPaymentLabel(method), marginL + 5, y)
    doc.text(formatCurrency(total), 120, y, { align: 'right' }); y += 5
  })

  y += 8; if (y > pageH - 60) { doc.addPage(); y = 20 }
  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('FACTURAS DEL PER√çODO', marginL, y); doc.setFont('helvetica', 'normal'); y += 3

  if (periodInvoices.length > 0) {
    autoTable(doc, {
      startY: y,
      head: [['#', 'Cliente', 'Subtotal', 'IVU', 'Total', 'Status']],
      body: periodInvoices.map(inv => [
        inv.invoice_number, inv.client_name, formatCurrency(inv.subtotal),
        formatCurrency(inv.tax_amount || 0), formatCurrency(inv.total),
        inv.status === 'paid' ? 'Pagada' : inv.status === 'overdue' ? 'Vencida' : inv.status === 'sent' ? 'Enviada' : 'Borrador'
      ]),
      headStyles: { fillColor: [0, 150, 150], fontSize: 8 }, bodyStyles: { fontSize: 8 }
    })
  } else { y += 5; doc.setFontSize(9); doc.setTextColor(100, 100, 100); doc.text('No hay facturas en este per√≠odo.', marginL + 5, y) }

  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i); doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }
  doc.save(`Contable-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ DELINQUENT CLIENTS / MOROSOS REPORT ============
export function generateDelinquentReport(invoices: Invoice[]) {
  const now = Date.now()
  const pending = invoices.filter(inv =>
    inv.type === 'invoice' && (inv.status === 'sent' || inv.status === 'overdue' || inv.status === 'draft')
  )

  const buckets = { current: [] as Invoice[], days31_60: [] as Invoice[], days61_90: [] as Invoice[], days90plus: [] as Invoice[] }
  pending.forEach(inv => {
    const daysOld = Math.floor((now - (inv.due_date || inv.created_at)) / 86400000)
    if (daysOld <= 30) buckets.current.push(inv)
    else if (daysOld <= 60) buckets.days31_60.push(inv)
    else if (daysOld <= 90) buckets.days61_90.push(inv)
    else buckets.days90plus.push(inv)
  })

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20, marginR = 20

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(14); doc.setTextColor(40, 40, 40); doc.text('Reporte de Clientes Morosos', marginL, 28)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100); doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 34)

  const totalPending = pending.reduce((s, inv) => s + inv.total, 0)
  doc.setFontSize(12); doc.setTextColor(239, 68, 68); doc.setFont('helvetica', 'bold')
  doc.text(`Total Pendiente: ${formatCurrency(totalPending)}`, marginL, 42); doc.setFont('helvetica', 'normal')

  let y = 52
  const agingSummary = [
    ['0-30 d√≠as', buckets.current, [59, 130, 246]], ['31-60 d√≠as', buckets.days31_60, [245, 158, 11]],
    ['61-90 d√≠as', buckets.days61_90, [249, 115, 22]], ['90+ d√≠as', buckets.days90plus, [239, 68, 68]]
  ] as const

  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('Resumen de Aging', marginL, y); doc.setFont('helvetica', 'normal'); y += 7

  agingSummary.forEach(([label, invs, color]) => {
    const total = (invs as Invoice[]).reduce((s: number, inv: Invoice) => s + inv.total, 0)
    doc.setFontSize(10); doc.setTextColor(color[0], color[1], color[2])
    doc.text(`${label}: ${(invs as Invoice[]).length} factura(s) ‚Äî ${formatCurrency(total)}`, marginL + 5, y); y += 6
  })

  y += 8
  if (pending.length > 0) {
    autoTable(doc, {
      startY: y,
      head: [['Factura', 'Cliente', 'Tel.', 'Emisi√≥n', 'Vence', 'Edad', 'Monto']],
      body: pending
        .sort((a, b) => Math.floor((now - (b.due_date || b.created_at)) / 86400000) - Math.floor((now - (a.due_date || a.created_at)) / 86400000))
        .map(inv => {
          const daysOld = Math.floor((now - (inv.due_date || inv.created_at)) / 86400000)
          return [inv.invoice_number, inv.client_name, inv.client_phone || '-', formatDateShort(inv.created_at),
            inv.due_date ? formatDateShort(inv.due_date) : '-', `${daysOld} d√≠as`, formatCurrency(inv.total)]
        }),
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 8 }, bodyStyles: { fontSize: 8 },
      didParseCell: (data) => {
        if (data.section === 'body' && data.column.index === 5) {
          const days = parseInt(data.cell.raw as string)
          if (days > 90) data.cell.styles.textColor = [239, 68, 68]
          else if (days > 60) data.cell.styles.textColor = [249, 115, 22]
          else if (days > 30) data.cell.styles.textColor = [245, 158, 11]
        }
      }
    })
  } else { doc.setFontSize(12); doc.setTextColor(34, 197, 94); doc.text('üéâ No hay facturas pendientes', marginL, y) }

  doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3); doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
  doc.setFontSize(8); doc.setTextColor(150, 150, 150); doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
  doc.save(`Morosos-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ CLIENT PROFITABILITY REPORT ============
export function generateClientProfitabilityReport(
  events: EventRecord[],
  clients: Client[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const filtered = events.filter(e => e.timestamp >= startDate && e.timestamp <= endDate && e.client_id != null)

  const byClient: Record<number, { name: string; income: number; expense: number; events: number }> = {}
  filtered.forEach(e => {
    const cid = e.client_id!
    if (!byClient[cid]) {
      const client = clients.find(c => c.id === cid)
      byClient[cid] = { name: client ? `${client.first_name} ${client.last_name}` : (e.client || `Cliente #${cid}`), income: 0, expense: 0, events: 0 }
    }
    byClient[cid].events++
    if (e.type === 'income') byClient[cid].income += e.amount
    else byClient[cid].expense += e.amount
  })

  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20, marginR = 20

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(13); doc.setTextColor(40, 40, 40); doc.text(`Rentabilidad por Cliente - ${periodLabel}`, marginL, 27)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100); doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, marginL, 33)

  const rows = Object.values(byClient)
    .sort((a, b) => (b.income - b.expense) - (a.income - a.expense))
    .map(c => {
      const profit = c.income - c.expense
      return [c.name, String(c.events), formatCurrency(c.income), formatCurrency(c.expense), formatCurrency(profit), c.income > 0 ? ((profit / c.income) * 100).toFixed(1) + '%' : 'N/A']
    })

  if (rows.length === 0) { doc.setFontSize(12); doc.text('No hay transacciones asociadas a clientes en este per√≠odo.', marginL, 50) }
  else {
    autoTable(doc, {
      startY: 42,
      head: [['Cliente', '# Trans.', 'Ingresos', 'Gastos', 'Ganancia', 'Margen']],
      body: rows,
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 9 }, bodyStyles: { fontSize: 9 },
      didParseCell: (data) => {
        if (data.section === 'body' && data.column.index === 4) {
          const val = parseFloat((data.cell.raw as string).replace('$', '').replace(',', ''))
          if (val < 0) data.cell.styles.textColor = [239, 68, 68]
          else data.cell.styles.textColor = [34, 197, 94]
        }
      }
    })
  }

  doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3); doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
  doc.setFontSize(8); doc.setTextColor(150, 150, 150); doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
  doc.save(`Rentabilidad-Clientes-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ RECURRING CONTRACTS REPORT ============
export function generateContractsReport(
  contracts: RecurringContract[],
  clients: Client[]
) {
  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20, marginR = 20

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(14); doc.setTextColor(40, 40, 40); doc.text('Reporte de Contratos Recurrentes', marginL, 28)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100); doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 34)

  const active = contracts.filter(c => c.status === 'active')
  const cancelled = contracts.filter(c => c.status === 'cancelled')

  const freqLabels: Record<string, string> = { monthly: 'Mensual', quarterly: 'Trimestral' }

  // Monthly recurring revenue
  const monthlyRevenue = active.reduce((s, c) => {
    if (c.frequency === 'monthly') return s + c.monthly_fee
    if (c.frequency === 'quarterly') return s + (c.monthly_fee / 3)
    return s + c.monthly_fee
  }, 0)

  let y = 44
  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('RESUMEN', marginL, y); doc.setFont('helvetica', 'normal'); y += 7
  doc.setFontSize(10)

  const items: [string, string][] = [
    ['Contratos Activos', String(active.length)],
    ['Contratos Cancelados', String(cancelled.length)],
    ['Ingreso Recurrente Mensual', formatCurrency(monthlyRevenue)],
    ['Ingreso Recurrente Anual (est.)', formatCurrency(monthlyRevenue * 12)]
  ]
  items.forEach(([label, value]) => {
    doc.setTextColor(60, 60, 60); doc.text(label, marginL + 5, y)
    doc.setTextColor(34, 197, 94); doc.setFont('helvetica', 'bold')
    doc.text(value, 130, y, { align: 'right' }); doc.setFont('helvetica', 'normal'); y += 6
  })

  // Active contracts
  y += 8
  doc.setFontSize(11); doc.setTextColor(34, 197, 94); doc.setFont('helvetica', 'bold')
  doc.text('CONTRATOS ACTIVOS', marginL, y); doc.setFont('helvetica', 'normal'); y += 3

  if (active.length > 0) {
    autoTable(doc, {
      startY: y,
      head: [['Cliente', 'Servicio', 'Frecuencia', 'Cuota', 'Pr√≥x. Servicio', 'Inicio']],
      body: active.map(c => {
        const client = clients.find(cl => cl.id === c.client_id)
        return [
          client ? `${client.first_name} ${client.last_name}` : `Cliente #${c.client_id}`,
          c.service_type || '-',
          freqLabels[c.frequency] || c.frequency,
          formatCurrency(c.monthly_fee),
          formatDateShort(c.next_service_due),
          formatDateShort(c.start_date)
        ]
      }),
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 8 }, bodyStyles: { fontSize: 8 }
    })
    y = (doc as any).lastAutoTable.finalY + 10
  } else { y += 5; doc.setFontSize(10); doc.setTextColor(100, 100, 100); doc.text('No hay contratos activos.', marginL + 5, y); y += 10 }

  // Cancelled contracts
  if (cancelled.length > 0) {
    if (y > pageH - 60) { doc.addPage(); y = 20 }
    doc.setFontSize(11); doc.setTextColor(100, 100, 100); doc.setFont('helvetica', 'bold')
    doc.text('CONTRATOS CANCELADOS', marginL, y); doc.setFont('helvetica', 'normal'); y += 3
    autoTable(doc, {
      startY: y,
      head: [['Cliente', 'Servicio', 'Frecuencia', 'Cuota']],
      body: cancelled.map(c => {
        const client = clients.find(cl => cl.id === c.client_id)
        return [
          client ? `${client.first_name} ${client.last_name}` : `Cliente #${c.client_id}`,
          c.service_type || '-',
          freqLabels[c.frequency] || c.frequency,
          formatCurrency(c.monthly_fee)
        ]
      }),
      headStyles: { fillColor: [120, 120, 120], textColor: [255, 255, 255], fontSize: 8 },
      bodyStyles: { fontSize: 8, textColor: [120, 120, 120] }
    })
  }

  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i); doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }
  doc.save(`Contratos-Recurrentes-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ PRODUCTIVITY / JOBS REPORT ============
export function generateProductivityReport(
  jobs: Job[],
  events: EventRecord[],
  clients: Client[],
  startDate: number,
  endDate: number,
  periodLabel: string
) {
  const doc = new jsPDF()
  const pageW = doc.internal.pageSize.getWidth()
  const pageH = doc.internal.pageSize.getHeight()
  const marginL = 20, marginR = 20

  // Filter jobs by date field
  const periodJobs = jobs.filter(j => j.date >= startDate && j.date <= endDate)
  const completedJobs = periodJobs.filter(j => j.status === 'completed')
  const activeJobs = periodJobs.filter(j => j.status === 'in_progress')
  const quoteJobs = periodJobs.filter(j => j.status === 'quote')

  // Revenue from jobs via events
  const jobIncome = events.filter(e => e.timestamp >= startDate && e.timestamp <= endDate && e.type === 'income' && e.job_id != null)
  const totalJobRevenue = jobIncome.reduce((s, e) => s + e.amount, 0)
  const avgRevenuePerJob = completedJobs.length > 0 ? totalJobRevenue / completedJobs.length : 0

  const jobExpenses = events.filter(e => e.timestamp >= startDate && e.timestamp <= endDate && e.type === 'expense' && e.job_id != null)
  const totalJobExpense = jobExpenses.reduce((s, e) => s + e.amount, 0)
  const jobProfit = totalJobRevenue - totalJobExpense

  try { doc.addImage('data:image/png;base64,' + LOGO_BASE64, 'PNG', pageW - marginR - 40, 10, 40, 17) } catch { }

  doc.setFontSize(18); doc.setTextColor(0, 150, 150); doc.text(COMPANY_NAME, marginL, 18)
  doc.setFontSize(13); doc.setTextColor(40, 40, 40); doc.text(`Productividad & Trabajos - ${periodLabel}`, marginL, 27)
  doc.setFontSize(9); doc.setTextColor(100, 100, 100)
  doc.text(`${formatDate(startDate)} - ${formatDate(endDate)}`, marginL, 33)
  doc.text(`Generado: ${formatDate(Date.now())}`, marginL, 38)

  let y = 48
  doc.setDrawColor(0, 150, 150); doc.setLineWidth(0.5); doc.line(marginL, y, pageW - marginR, y); y += 8
  doc.setFontSize(12); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('INDICADORES CLAVE', marginL, y); doc.setFont('helvetica', 'normal'); y += 8

  const typeLabels: Record<string, string> = {
    installation: 'Instalaci√≥n', repair: 'Reparaci√≥n', maintenance: 'Mantenimiento',
    emergency: 'Emergencia', warranty: 'Garant√≠a', quote: 'Cotizaci√≥n'
  }

  const statusLabels: Record<string, string> = {
    quote: 'Cotizaci√≥n', in_progress: 'En Progreso', completed: 'Completado', cancelled: 'Cancelado'
  }

  const kpis: [string, string][] = [
    ['Total Trabajos', String(periodJobs.length)],
    ['Completados', String(completedJobs.length)],
    ['En Progreso', String(activeJobs.length)],
    ['Cotizaciones', String(quoteJobs.length)],
    ['Tasa de Completaci√≥n', periodJobs.length > 0 ? ((completedJobs.length / periodJobs.length) * 100).toFixed(0) + '%' : 'N/A'],
    ['', ''],
    ['Ingreso por Trabajos', formatCurrency(totalJobRevenue)],
    ['Gastos en Trabajos', formatCurrency(totalJobExpense)],
    ['Ganancia en Trabajos', formatCurrency(jobProfit)],
    ['Ingreso Promedio/Trabajo', formatCurrency(avgRevenuePerJob)],
    ['Margen por Trabajo', totalJobRevenue > 0 ? ((jobProfit / totalJobRevenue) * 100).toFixed(1) + '%' : 'N/A']
  ]

  doc.setFontSize(10)
  kpis.forEach(([label, value]) => {
    if (label === '') { y += 4; return }
    doc.setTextColor(60, 60, 60); doc.text(label, marginL + 5, y)
    doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
    doc.text(value, 130, y, { align: 'right' }); doc.setFont('helvetica', 'normal'); y += 6
  })

  // Jobs detail table
  y += 10; if (y > pageH - 60) { doc.addPage(); y = 20 }
  doc.setFontSize(11); doc.setTextColor(30, 30, 30); doc.setFont('helvetica', 'bold')
  doc.text('DETALLE DE TRABAJOS', marginL, y); doc.setFont('helvetica', 'normal'); y += 3

  if (periodJobs.length > 0) {
    autoTable(doc, {
      startY: y,
      head: [['Fecha', 'Cliente', 'Tipo', 'Status', 'Cobrado', 'Balance']],
      body: periodJobs.sort((a, b) => b.date - a.date).map(j => {
        const client = clients.find(c => c.id === j.client_id)
        const clientName = client ? `${client.first_name} ${client.last_name}` : `Cliente #${j.client_id}`
        return [
          formatDateShort(j.date),
          clientName,
          typeLabels[j.type] || j.type,
          statusLabels[j.status] || j.status,
          formatCurrency(j.total_charged),
          formatCurrency(j.balance_due)
        ]
      }),
      headStyles: { fillColor: [0, 150, 150], textColor: [255, 255, 255], fontSize: 8 },
      bodyStyles: { fontSize: 8 },
      didParseCell: (data) => {
        if (data.section === 'body' && data.column.index === 3) {
          const status = data.cell.raw as string
          if (status === 'Completado') data.cell.styles.textColor = [34, 197, 94]
          else if (status === 'Cancelado') data.cell.styles.textColor = [239, 68, 68]
          else data.cell.styles.textColor = [59, 130, 246]
        }
        if (data.section === 'body' && data.column.index === 5) {
          const val = parseFloat((data.cell.raw as string).replace('$', '').replace(',', ''))
          if (val > 0) data.cell.styles.textColor = [239, 68, 68]
          else data.cell.styles.textColor = [34, 197, 94]
        }
      }
    })
  } else { y += 5; doc.setFontSize(10); doc.setTextColor(100, 100, 100); doc.text('No hay trabajos en este per√≠odo.', marginL + 5, y) }

  const totalPages = doc.getNumberOfPages()
  for (let i = 1; i <= totalPages; i++) {
    doc.setPage(i); doc.setDrawColor(200, 200, 200); doc.setLineWidth(0.3)
    doc.line(marginL, pageH - 15, pageW - marginR, pageH - 15)
    doc.setFontSize(8); doc.setTextColor(150, 150, 150)
    doc.text(COMPANY_SLOGAN, pageW / 2, pageH - 8, { align: 'center' })
    doc.text(`P√°gina ${i} de ${totalPages}`, pageW - marginR, pageH - 8, { align: 'right' })
  }
  doc.save(`Productividad-${periodLabel.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`)
}

// ============ CSV EXPORT ============
export function exportEventsCSV(
  events: EventRecord[],
  startDate: number,
  endDate: number
) {
  const filtered = events.filter(e => e.timestamp >= startDate && e.timestamp <= endDate).sort((a, b) => a.timestamp - b.timestamp)

  const headers = ['Fecha', 'Tipo', 'Categor√≠a', 'Monto', 'M√©todo de Pago', 'Vendor/Cliente', 'Nota', 'Tipo Gasto', 'Veh√≠culo']
  const rows = filtered.map(e => [
    new Date(e.timestamp).toLocaleDateString('es-PR'),
    e.type === 'income' ? 'Ingreso' : 'Gasto',
    e.category || '',
    e.amount.toFixed(2),
    getPaymentLabel(e.payment_method),
    e.vendor || e.client || '',
    (e.note || '').replace(/,/g, ';').replace(/\n/g, ' '),
    e.expense_type || 'business',
    e.vehicle_id || ''
  ])

  const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n')
  const BOM = '\uFEFF'
  const blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' })
  const url = URL.createObjectURL(blob)
  const a = document.createElement('a')
  a.href = url
  a.download = `Transacciones-${new Date(startDate).toISOString().split('T')[0]}-a-${new Date(endDate).toISOString().split('T')[0]}.csv`
  a.click()
  URL.revokeObjectURL(url)
}